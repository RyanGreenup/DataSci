---
title: "2020 Project"
subtitle: "Thinking About Data"
author: "Ryan G - 17805315"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---


# Declaration
* I hold a copy of this assignment that we can produce if the original is lost or damaged.
* I hereby certify that no part of this assignment/product has been copied from any other studentâ€™s work
or from any other source except where due acknowledgement is made in the assignment.
* No part of this assignment/product has been written/produced for us by another person except where
such collaboration has been authorised by the subject lecturer/tutor concerned.
* I am aware that this work may be reproduced and submitted to plagiarism detection software programs
for the purpose of detecting possible plagiarism (which may retain a copy on its database for future
plagiarism checking).
* I hereby certify that we have read and understand what the School of Computing and Mathematics
defines as minor and substantial breaches of misconduct as outlined in the learning guide for this unit.

# Problem
>  The health minister of Australia has been concerned about the increase in new cases of people infected with
> the Tiara virus. They have hired you as a consultant to examine their data on the new cases of Tiara virus
> and the flu. The data is provided to you in a CSV file called project2020A.csv containing observations of
> the daily new cases of both the Tiara and flu viruses for each state in Australia over a 100 day period. The
> variables are:
> 
> * `city`: The city in which the new cases of the virus is counted.
> * `newTiara`: The number of new cases of the Tiara virus for the day.
> * `newFlu`: The number of new cases of the flu virus for the day.
> * `date`: the day number starting from 1 and ending at 100.
> 
> The health minister wants statistics measured from the data so that they can be reported to the public. The
> five required pieces of analysis are presented below.
# Preamble
Before beginning it is necessary to set the working directory, load any necessary packages and load the data set.


```{r}
## Preamble
# setwd("~/Dropbox/Notes/DataSci/ThinkingAboutData/Assessment/")
## Install Pacman
load.pac <- function() {
  
  if(require("pacman")){
    library(pacman)
  }else{
    install.packages("pacman")
    library(pacman)
  }
  
    pacman::p_load(xts, sp, gstat, ggplot2, rmarkdown, reshape2, ggmap,
                 parallel, dplyr, plotly, tidyverse, reticulate, UsingR, Rmpfr,
                 swirl, corrplot, gridExtra, mise, latex2exp, tree, rpart, lattice,
                 coin, primes, epitools, maps, clipr, ggmap, RColorBrewer)
  
  
   mise()
   select <- dplyr::select
}

load.pac()
setwd(dir = "/home/ryan/Notes/DataSci/ThinkingAboutData/")
load(file = "~/Notes/DataSci/ThinkingAboutData/TAD.rdata")
load(file = "./TAD.rdata")
print("Success")
```

The data can be inspected thusly:

```{r}
(read.csv("../0datasets/project2020A.csv") -> data)  %>% head()
str(data)
summary(data)

if(sum(is.na(data)) > 0) {
  print("The data Needs to be Cleaned")
} else {
  print("The data does not require cleaning")
}
```

This data set has provides 400 observations with 4 features, one of which is categorical. There is no missing data in this data set.

# Question 1
> Assume that the number of new flu cases each day are independent over the set of days. Test if the mean
> number of new flu cases over the set of days is different for each city, and if so determine which cities have a
> statistically different mean.

It is first necessary to get the data into a tidy format, so first encode the categorical variable as a `factor`:

```{r}
data$city  <- factor(data$city)
```

Now aggregate the data:

```{r}
mean_city <- aggregate(newFlu ~ city, data, mean, na.rm = TRUE)

## `element_blank()` has better spacing than + labs(x = "")
```

USE ANOVA, make a boxplot, that's what w


## Plot
This aggregated data can be plotted, illustrating the average number of new flu infections accross cities under the assumption that the rate of infection is independent of time.

```{r}
p <- ggplot(data, aes(x = city, y = newFlu, fill = city)) +
  theme_classic() +
  labs(title = "Avereage Flu Cases Per Day",
       subtitle = "Under the Assumption of Time Independence",
y = "Average Flu Infections Per Day") +
  theme(axis.title.x = element_blank())

p + geom_boxplot() 
```


## Observations from Plot
This strongly suggests that the number of infections in Sydney and Melbourne are
higher than in Adelaide or Brisbane, it would be reasonable to expect that
Sydney would have a statistically higher mean value of new cases.

## Analysis and Results
In order to assess whether or not the mean value does differ accross these
cities a hypothesis test will be established.

### Hypothesis
* $H_0: \quad$ The mean value accross populations does not change
  * And hence we would expect the mean value to be the mean grand
* $H_{a}: \quad$ There is a difference between the mean values across cities.

### Test statistic
The $\chi^2$ statistic is given by equation \eqref{chi}:

$$
\chi^2 = \sum^n_{i= 0}\left[  \frac{(e-o)^2}{e}  \right] \label{chi}
$$

where:

* $i$ is the city
* $e$ is the expected value of the city (under the null hypothesis)
* $o$ is the observed value of the city.

This is a measurement of how different the observed data is from the null
hypothesis.

### Rejection Region
Rather than using the $\chi^{2}$ statistic directly, the statistic of concern will be the
probability of a Type I error ($\alpha$) which is essentially a false positive.

The null hypothesis will be rejected for an $\alpha$ value less than 5%, this
represents a low probability of a type I error which is good evidence for
rejecting the null hypothesis.

### Statistic

The $p$-value is the measured probability of a type I error, it can be measured
by simulating the data under the assumption that the null hypothesis is true and
measuring the frequency at which the null hypothesis would be rejected by mere
chance, that frequency will be accepted as the probability of a type I error.

In order to simulate the data, the observations can be permuted in order remove
any meaningful difference between mean values that would violate the null
hypothesis and the $\chi^{2}$ statistic measured. The frequency at which a more
extreme observation is observed is the $p$ value.

```{r}
filter <- dplyr::filter

e  <- mean(mean_city$newFlu)
o  <- mean_city$newFlu
chi_sq <- sum((e-o)^2/e)

chi_sim_vec <- replicate(10^3, {
    city_perm <- sample(x = data$city)
    Flu_sim   <- aggregate(newFlu ~ city_perm, data, mean) 
    o_sim     <- Flu_sim$newFlu
    
    sum((e-o_sim)^2/e)
  })

```

Now we simply need to ask the question, "*was there a False Positive?*":
```{r}
mean(chi_sim_vec > chi_sq)
```


## Conclusion
# Question 2
## Plot
## Observations from Plot
## Analysis and Results
## Conclusion
# Question 3
## Plot
## Observations from Plot
## Analysis and Results
## Conclusion

# Question 4
## Plot
## Observations from Plot
## Analysis and Results
## Conclusion
# Question 5
## Plot
## Observations from Plot
## Analysis and Results
## Conclusion
